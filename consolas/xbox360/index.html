<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Xbox 360 | GameTechSolutions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/assets/img/favicon.png">

  <!-- Base global -->
  <link rel="stylesheet" href="/styles/theme-base.css">
  <link rel="stylesheet" href="/styles/theme-microsoft.css">
</head>
<body>

<!-- HEADER -->
<div id="header-container"></div>

<main>
  <div class="container">

    <!-- =========================
         INTRO
    ========================== -->
    <section>
      <h2>Servicios para Xbox 360</h2>
      <p>
        Selecciona el modelo de tu consola y los servicios que deseas contratar.
      </p>
    </section>

    <!-- =========================
         IDENTIFICAR MODELO
    ========================== -->
    <section>
      <h2>Identifica tu modelo</h2>
      <p>Selecciona el modelo exacto de tu Xbox 360.</p>

      <div class="cards-grid" id="modelsContainer">
        <!-- Modelos cargados por JS -->
      </div>
    </section>

    <!-- =========================
         SERVICIOS
    ========================== -->
    <section>
      <h2>Selecciona los servicios</h2>
      <p>
        Puedes elegir uno o varios servicios según lo que necesites.
      </p>

      <div class="cards-grid" id="servicesContainer">
        <!-- Servicios cargados por JS -->
      </div>

      <div style="margin-top:20px; text-align:center;">
        <button class="btn" id="nextStepBtn" disabled>
          Siguiente paso
        </button>
      </div>
    </section>

  </div>
</main>

<!-- FOOTER -->
<footer>
  <p>GameTechSolutions © 2026</p>
</footer>

<!-- =========================
     CONFIG CONSOLA
========================== -->
<script>
  window.IDENTIFY_CONFIG = {
    console: {
      code: 'X360',
      name: 'Xbox 360',
      brand: 'microsoft'
    }
  };
</script>

<!-- =========================
     SCRIPTS BASE
========================== -->
<script src="/assets/js/header.js"></script>

<!-- =========================
     IDENTIFICAR MODELO
========================== -->
<script>
document.addEventListener('DOMContentLoaded', async () => {

  const modelsContainer = document.getElementById('modelsContainer');
  const servicesContainer = document.getElementById('servicesContainer');
  const nextBtn = document.getElementById('nextStepBtn');

  let ctx =
    JSON.parse(localStorage.getItem('GTS_CONTEXT')) || {};

  /* =============================
     BASE CONTEXTO
  ============================== */

  ctx.console = {
    code: 'X360',
    name: 'Xbox 360',
    brand: 'microsoft'
  };

  ctx.services = ctx.services || [];

  localStorage.setItem('GTS_CONTEXT', JSON.stringify(ctx));

  /* =============================
     CARGAR MODELOS
  ============================== */

  fetch('/assets/data/identificar/xbox360.json')
    .then(res => res.json())
    .then(data => {
      renderModels(data.models);
    });

  function renderModels(models) {
    modelsContainer.innerHTML = '';

    models.forEach(model => {
      const card = document.createElement('div');
      card.className = 'card';

      card.innerHTML = `
        <h3>${model.name}</h3>
        ${model.image ? `<img src="${model.image}" alt="${model.name}">` : ''}
        <p>${model.notes || ''}</p>
        <button class="btn btn-outline">
          Seleccionar modelo
        </button>
      `;

      card.querySelector('button').addEventListener('click', () => {
        selectModel(model, card);
      });

      modelsContainer.appendChild(card);
    });
  }

  function selectModel(model, card) {
    ctx.model = {
      id: model.id,
      description: model.name,
      notes: model.notes || ''
    };

    document
      .querySelectorAll('#modelsContainer .card')
      .forEach(c => c.classList.remove('active'));

    card.classList.add('active');

    localStorage.setItem('GTS_CONTEXT', JSON.stringify(ctx));
  }

  /* =============================
     CARGAR SERVICIOS
  ============================== */

  const res = await fetch('/assets/data/services.json');
  const servicesData = await res.json();

  const xboxServices = servicesData.X360?.services;

  if (!xboxServices) {
    servicesContainer.innerHTML =
      '<p>No hay servicios disponibles.</p>';
    return;
  }

  Object.values(xboxServices).forEach(service => {
    const card = document.createElement('div');
    card.className = 'card';

    const priceText =
      service.price
        ? `$${service.price} MXN`
        : service.priceByStorage
          ? 'Precio según almacenamiento'
          : 'Precio variable';

    card.innerHTML = `
      <h3>${service.name}</h3>
      <p>${service.description}</p>
      <p><strong>${priceText}</strong></p>
      <button class="btn btn-outline">
        Agregar servicio
      </button>
    `;

    const btn = card.querySelector('button');

    btn.addEventListener('click', () => {
      toggleService(service, btn);
    });

    servicesContainer.appendChild(card);
  });

  function toggleService(service, btn) {
    const exists =
      ctx.services.some(s => s.id === service.id);

    if (exists) {
      ctx.services = ctx.services.filter(
        s => s.id !== service.id
      );
      btn.textContent = 'Agregar servicio';
      btn.classList.remove('active');
    } else {
      ctx.services.push({
        id: service.id,
        name: service.name,
        category: service.category
      });
      btn.textContent = 'Quitar servicio';
      btn.classList.add('active');
    }

    localStorage.setItem('GTS_CONTEXT', JSON.stringify(ctx));
    validateNextStep();
  }

  function validateNextStep() {
    nextBtn.disabled = !ctx.model || ctx.services.length === 0;
  }

  /* =============================
     SIGUIENTE PASO
  ============================== */

  nextBtn.addEventListener('click', () => {
    localStorage.setItem('GTS_CONTEXT', JSON.stringify(ctx));

    alert(
      'Modelo y servicios guardados.\n' +
      'El siguiente paso se definirá después.'
    );
  });

});
</script>

</body>
</html>
