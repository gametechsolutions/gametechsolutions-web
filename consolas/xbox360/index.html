<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Xbox 360 | GameTechSolutions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="icon" type="image/png" href="/assets/img/favicon.png" />
  <link rel="stylesheet" href="/styles/theme-base.css" />
  <link rel="stylesheet" href="/styles/theme-microsoft.css" />
</head>
<body>

<!-- HEADER -->
<div id="header-container"></div>

<main>
  <div class="container">

    <!-- INTRO -->
    <section>
      <h2>Servicio para Xbox 360</h2>
      <p>
        Selecciona el modelo de tu consola y los servicios que necesitas.
      </p>
    </section>

    <!-- =========================
         1. IDENTIFICAR MODELO
    ========================== -->
    <section>
      <h2>1Ô∏è‚É£ Identifica tu modelo</h2>

      <div class="cards-grid" id="modelsContainer">
        <!-- Inyectado por JS -->
      </div>
    </section>

    <!-- =========================
         2. SERVICIOS
    ========================== -->
    <section>
      <h2>2Ô∏è‚É£ Selecciona los servicios</h2>

      <div class="cards-grid" id="servicesContainer">
        <!-- Inyectado desde services.json -->
      </div>
    </section>
    
    <!-- AVISO COMPATIBILIDAD RGH -->
<section id="rghNotice" style="display:none">
  <div class="alert warning">
    ‚ö†Ô∏è <strong>Compatibilidad con RGH (Modelo E)</strong><br><br>
    No todas las Xbox 360 modelo <strong>E</strong> son compatibles con RGH.
    <br><br>
    üëâ La compatibilidad final se confirma √∫nicamente mediante
    <strong>revisi√≥n f√≠sica de la consola</strong>.
  </div>
</section>

    <!-- =========================
         3. ALMACENAMIENTO
    ========================== -->
    <section id="storageSection" style="display:none">
      <h2>3Ô∏è‚É£ Almacenamiento</h2>

      <p>Selecciona el disco duro que aplica a tu servicio.</p>

      <div class="disk-selector">
        <label class="disk-option">
          <input type="radio" name="diskSize" value="120" data-limit="110">
          <strong>120 GB</strong>
        </label>

        <label class="disk-option">
          <input type="radio" name="diskSize" value="250" data-limit="230">
          <strong>250 GB</strong>
        </label>

        <label class="disk-option">
          <input type="radio" name="diskSize" value="320" data-limit="293">
          <strong>320 GB</strong>
        </label>

        <label class="disk-option">
          <input type="radio" name="diskSize" value="500" data-limit="465">
          <strong>500 GB</strong>
        </label>

        <label class="disk-option">
          <input type="radio" name="diskSize" value="1000" data-limit="930">
          <strong>1 TB</strong>
        </label>
      </div>
    </section>

    <!-- =========================
         CTA
    ========================== -->
    <section style="text-align:center; margin-top:30px">
      <button class="btn" id="continueBtn" disabled>
        Siguiente paso ‚Üí
      </button>
    </section>

  </div>
</main>

<footer>
  <p>GameTechSolutions ¬© 2026</p>
</footer>

<!-- CONFIG -->
<script>
  window.CONSOLE_CONFIG = {
    code: 'X360',
    name: 'Xbox 360',
    brand: 'microsoft'
  };
</script>

<!-- JS BASE -->
<script src="/assets/js/context.js"></script>
<script src="/assets/js/header.js"></script>

<!-- L√ìGICA DE P√ÅGINA -->
<script>
document.addEventListener('DOMContentLoaded', async () => {

  const ctx = window.GTSContext?.load() || {};

  /* =============================
     MODELOS
  ============================== */

  fetch('/assets/data/identificar/xbox360.json')
    .then(r => r.json())
    .then(data => renderModels(data.models));

  function renderModels(models) {
    const container = document.getElementById('modelsContainer');
    container.innerHTML = '';

    models.forEach(model => {
      const card = document.createElement('div');
      card.className = 'card';

      card.innerHTML = `
        <h3>${model.name}</h3>

        ${model.image ? `
          <div class="model-image">
            <img src="${model.image}" alt="${model.name}">
          </div>
        ` : ''}

        <p>${model.notes || ''}</p>

        <button class="btn btn-outline">Seleccionar</button>
      `;

      card.querySelector('button').addEventListener('click', () => {
        window.GTSContext.save({
          console: window.CONSOLE_CONFIG,
          model: {
            id: model.id,
            description: model.name
          }
        });
        checkReady();
      });

      container.appendChild(card);
    });
  }

  /* =============================
     SERVICIOS
  ============================== */

  const servicesRes = await fetch('/assets/data/services.json');
  const servicesData = await servicesRes.json();
  const servicesMap = servicesData.X360.services;
  const services = Object.values(servicesMap);

  const servicesContainer = document.getElementById('servicesContainer');
  const selectedServices = new Set();

  services.forEach(service => {
    const card = document.createElement('div');
    card.className = 'card';

    card.innerHTML = `
      <h3>${service.name}</h3>
      <p>${service.description}</p>
      <button class="btn btn-outline">Agregar</button>
    `;

    const btn = card.querySelector('button');

    btn.addEventListener('click', () => {
      if (selectedServices.has(service.id)) {
        selectedServices.delete(service.id);
        btn.textContent = 'Agregar';
      } else {
        selectedServices.add(service.id);
        btn.textContent = 'Quitar';
      }

      window.GTSContext.save({
        services: Array.from(selectedServices)
      });

      toggleStorage(services);
      checkReady();
    });

    servicesContainer.appendChild(card);
  });

  /* =============================
     ALMACENAMIENTO
  ============================== */

  function toggleStorage(allServices) {
    const needsStorage = Array.from(selectedServices).some(id => {
      const svc = allServices.find(s => s.id === id);
      return svc?.requiresStorage;
    });

    document.getElementById('storageSection').style.display =
      needsStorage ? 'block' : 'none';
  }

  document.querySelectorAll('input[name="diskSize"]').forEach(radio => {
    radio.addEventListener('change', () => {
      window.GTSContext.save({
        storage: {
          label: `${radio.value} GB`,
          usableGB: Number(radio.dataset.limit)
        }
      });
      checkReady();
    });
  });

  /* =============================
     CONTINUAR
  ============================== */

  function checkReady() {
    const ctx = window.GTSContext.load();

    const ready =
      ctx.model &&
      ctx.services?.length &&
      (!needsCatalog(ctx) || ctx.storage);

    document.getElementById('continueBtn').disabled = !ready;
  }

  function needsCatalog(ctx) {
    return ctx.services?.some(id => {
      const svc = services.find(s => s.id === id);
      return svc?.requiresCatalog;
    });
  }

  document.getElementById('continueBtn').addEventListener('click', () => {
    const ctx = window.GTSContext.load();

    if (needsCatalog(ctx)) {
      window.location.href = '/consolas/xbox360/catalogo.html';
    } else {
      window.location.href = '/contacto/';
    }
  });

});
</script>

</body>
</html>
